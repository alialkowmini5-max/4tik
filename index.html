<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>FlowTik</title>

    <style>
        body {
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
            visibility: hidden;
        }

        body.loaded {
            opacity: 1;
            visibility: visible;
        }
    </style>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Cairo:wght@400;700&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/fingerprint.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ffmpeg-manager.js"></script>
    <script src="lib/ffmpeg.min.js"></script>

    <style>
        :root {
            /* New Comfortable Palette (Slate/Indigo) */
            --primary: #8b5cf6;
            /* Violet 500 */
            --primary-dark: #7c3aed;
            /* Violet 600 */
            --secondary: #6366f1;
            /* Indigo 500 */
            --accent: #a78bfa;
            /* Violet 400 */

            --bg-body: #0f172a;
            /* Slate 900 - Deep, rich dark blue */
            --bg-card: rgba(30, 41, 59, 0.7);
            /* Slate 800 with opacity */

            /* Text Colors for comfort */
            --text-primary: #f8fafc;
            /* Slate 50 - Soft white */
            --text-secondary: #94a3b8;
            /* Slate 400 - Muted grey-blue */

            /* Shadows & Borders */
            --card-border: rgba(148, 163, 184, 0.1);
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 20px rgba(139, 92, 246, 0.15);
            /* Soft Violet Glow */

            --border-radius-xl: 24px;
            --border-radius-xxl: 32px;
            --transition-all: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            background: #0a0e1a;
            /* Deeper, richer dark blue */
            background: radial-gradient(circle at top center, #1a1f35 0%, #0a0e1a 50%, #050810 100%);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-attachment: fixed;
            overflow-x: hidden;
            padding-bottom: 80px;
            line-height: 1.6;
            position: relative;
        }

        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(99, 102, 241, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(167, 139, 250, 0.02) 0%, transparent 50%);
            animation: floatParticles 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes floatParticles {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-20px) scale(1.05);
            }
        }

        /* --- Header --- */
        .app-header {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 20px 10px 20px;
            margin-top: 10px;
            z-index: 10;
            opacity: 0;
            animation: slideDown 0.6s ease-out 0.1s forwards;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header-logo-container {
            flex: 1;
            display: flex;
            justify-content: center;
            position: absolute;
            left: 0;
            right: 0;
            text-align: center;
            z-index: 1;
        }

        .header-logo {
            font-weight: 800;
            font-size: 1.9rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(153, 41, 234, 0.4);
        }

        .header-button {
            width: 45px;
            height: 45px;
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(12px);
            border-radius: 14px;
            /* More squarish modern look */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            color: var(--accent);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .header-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(153, 41, 234, 0.25);
            background: rgba(30, 30, 30, 0.8);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* --- Toast Notifications --- */
        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            /* Center horizontally */
            transform: translateX(-50%);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 90%;
            max-width: 400px;
            pointer-events: none;
            /* Let clicks pass through container */
        }

        .toast {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            color: var(--text-primary);
            padding: 16px 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: toastSlideDown 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid var(--card-border);
            pointer-events: auto;
            position: relative;
            overflow: hidden;
            min-height: 60px;
        }

        .toast::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary);
        }

        .toast.success::before {
            background: #10B981;
            box-shadow: 0 0 10px #10B981;
        }

        .toast.error::before {
            background: #EF4444;
            box-shadow: 0 0 10px #EF4444;
        }

        .toast.info::before {
            background: #3B82F6;
            box-shadow: 0 0 10px #3B82F6;
        }

        .toast.warning::before {
            background: #F59E0B;
            box-shadow: 0 0 10px #F59E0B;
        }

        .toast-icon {
            font-size: 1.4rem;
        }

        .toast.success .toast-icon {
            color: #10B981;
        }

        .toast.error .toast-icon {
            color: #EF4444;
        }

        .toast.info .toast-icon {
            color: #3B82F6;
        }

        .toast.warning .toast-icon {
            color: #F59E0B;
        }

        .toast-message {
            flex: 1;
            font-size: 0.95rem;
            font-weight: 500;
            line-height: 1.4;
        }

        @keyframes toastSlideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes toastFadeOut {
            to {
                opacity: 0;
                transform: scale(0.95);
            }
        }

        /* --- Content Sections --- */
        .content-section {
            width: 100%;
            max-width: 520px;
            padding: 0 15px;
            margin-bottom: 20px;
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Staggered animation for child elements */
        .content-section.active>* {
            animation: fadeInStagger 0.6s ease-out both;
        }

        .content-section.active>*:nth-child(1) {
            animation-delay: 0.3s;
        }

        .content-section.active>*:nth-child(2) {
            animation-delay: 0.4s;
        }

        .content-section.active>*:nth-child(3) {
            animation-delay: 0.5s;
        }

        .content-section.active>*:nth-child(4) {
            animation-delay: 0.6s;
        }

        @keyframes fadeInStagger {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Modern Card Design --- */
        .glass-card {
            background: var(--bg-card);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-radius: var(--border-radius-xxl);
            padding: 40px 30px;
            text-align: center;
            position: relative;
            z-index: 1;
            box-shadow: var(--shadow-glow);
            border: 1px solid var(--card-border);
            transition: var(--transition-all);
            margin-bottom: 30px;
            overflow: visible;
            /* Allow hover effects to popup if needed */
        }

        /* Remove the old gradient border animation for a cleaner look */
        .glass-card::before {
            display: none;
        }

        .glass-card::after {
            display: none;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: -3px;
            right: -3px;
            bottom: -3px;
            left: -3px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent), var(--primary), var(--secondary));
            z-index: -1;
            border-radius: calc(var(--border-radius-xxl) + 3px);
            animation: gradientRotate 6s linear infinite;
            opacity: 0.9;
            filter: blur(4px);
        }

        .glass-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: var(--card-bg);
            z-index: -1;
            border-radius: var(--border-radius-xxl);
            backdrop-filter: blur(15px);
        }

        @keyframes gradientRotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px -15px rgba(153, 41, 234, 0.4);
        }

        .upload-icon {
            font-size: 64px;
            color: var(--primary);
            margin-bottom: 25px;
            transition: var(--transition-all);
            filter: drop-shadow(0 0 15px rgba(139, 92, 246, 0.4));
        }

        .glass-card:hover .upload-icon {
            transform: scale(1.1) rotate(5deg);
            color: var(--accent);
        }

        /* --- Magic Button (Uiverse) --- */
        /* From Uiverse.io by MuhammadHasann */
        .magic-btn {
            --black-700: rgba(15, 23, 42, 0.95);
            /* Theme Match */
            --border_radius: 9999px;
            --transtion: 0.3s ease-in-out;
            --offset: 2px;

            cursor: pointer;
            position: relative;

            display: flex;
            align-items: center;
            gap: 0.8rem;

            transform-origin: center;

            padding: 1rem 3rem;
            /* Increased padding */
            background-color: transparent;

            border: none;
            border-radius: var(--border_radius);
            transform: scale(calc(1 + (var(--active, 0) * 0.1)));

            transition: transform var(--transtion);
            width: 100%;
            /* Full width container */
            max-width: 280px;
            /* Centered max width */
            justify-content: center;
        }

        .magic-btn::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);

            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(20, 25, 45, 0.98) 0%, rgba(15, 23, 42, 0.95) 100%);
            /* Richer dark gradient */

            border-radius: var(--border_radius);
            box-shadow: inset 0 0.5px hsl(0, 0%, 100%), inset 0 -1px 2px 0 hsl(0, 0%, 0%),
                0px 4px 10px -4px hsla(0 0% 0% / calc(1 - var(--active, 0))),
                0 0 0 calc(var(--active, 0) * 0.375rem) rgba(139, 92, 246, 0.75);
            /* Theme Color */

            transition: all var(--transtion);
            z-index: 0;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .magic-btn::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);

            width: 100%;
            height: 100%;
            background-color: rgba(139, 92, 246, 0.75);
            /* Theme Color */
            background-image: radial-gradient(at 51% 89%,
                    rgba(167, 139, 250, 1) 0px,
                    transparent 50%),
                radial-gradient(at 100% 100%, rgba(139, 92, 246, 1) 0px, transparent 50%),
                radial-gradient(at 22% 91%, rgba(139, 92, 246, 1) 0px, transparent 50%);
            background-position: top;

            opacity: var(--active, 0);
            border-radius: var(--border_radius);
            transition: opacity var(--transtion);
            z-index: 2;
        }

        .magic-btn:is(:hover, :focus-visible) {
            --active: 1;
        }

        .magic-btn:active {
            transform: scale(1);
        }

        /* Subtle pulse when button is enabled (not disabled) */
        .magic-btn:not(:disabled)::before {
            animation: subtlePulse 3s ease-in-out infinite;
        }

        @keyframes subtlePulse {

            0%,
            100% {
                box-shadow: inset 0 0.5px hsl(0, 0%, 100%), inset 0 -1px 2px 0 hsl(0, 0%, 0%),
                    0px 4px 10px -4px hsla(0 0% 0% / calc(1 - var(--active, 0))),
                    0 0 0 calc(var(--active, 0) * 0.375rem) rgba(139, 92, 246, 0.75);
            }

            50% {
                box-shadow: inset 0 0.5px hsl(0, 0%, 100%), inset 0 -1px 2px 0 hsl(0, 0%, 0%),
                    0px 4px 10px -4px hsla(0 0% 0% / calc(1 - var(--active, 0))),
                    0 0 0 calc(var(--active, 0) * 0.375rem) rgba(139, 92, 246, 0.75),
                    0 0 20px rgba(139, 92, 246, 0.3);
            }
        }

        .magic-btn .dots_border {
            --size_border: calc(100% + 4px);

            overflow: hidden;

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);

            width: var(--size_border);
            height: var(--size_border);
            background-color: transparent;

            border-radius: var(--border_radius);
            z-index: -10;
        }

        .magic-btn .dots_border::before {
            content: "";
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            transform-origin: left;
            transform: rotate(0deg);

            width: 100%;
            height: 2rem;
            background-color: white;

            mask: linear-gradient(transparent 0%, white 120%);
            animation: rotate 2s linear infinite;
        }

        @keyframes rotate {
            to {
                transform: rotate(360deg);
            }
        }

        .magic-btn .sparkle {
            position: relative;
            z-index: 10;

            width: 1.75rem;
        }

        .magic-btn .sparkle .path {
            fill: currentColor;
            stroke: currentColor;
            transform-origin: center;
            color: hsl(0, 0%, 100%);
        }

        .magic-btn:is(:hover, :focus) .sparkle .path {
            animation: path 1.5s linear 0.5s infinite;
        }

        .magic-btn .sparkle .path:nth-child(1) {
            --scale_path_1: 1.2;
        }

        .magic-btn .sparkle .path:nth-child(2) {
            --scale_path_2: 1.2;
        }

        .magic-btn .sparkle .path:nth-child(3) {
            --scale_path_3: 1.2;
        }

        @keyframes path {

            0%,
            34%,
            71%,
            100% {
                transform: scale(1);
            }

            17% {
                transform: scale(var(--scale_path_1, 1));
            }

            49% {
                transform: scale(var(--scale_path_2, 1));
            }

            83% {
                transform: scale(var(--scale_path_3, 1));
            }
        }

        .magic-btn .text_button {
            position: relative;
            z-index: 10;
            background-image: linear-gradient(90deg,
                    hsla(0 0% 100% / 1) 0%,
                    hsla(0 0% 100% / var(--active, 0)) 120%);
            background-clip: text;
            font-size: 1.1rem;
            font-weight: 700;
            color: transparent;
        }

        /* Disabled State for Magic Button */
        .magic-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
            --active: 0 !important;
        }

        .magic-btn:disabled:hover {
            transform: none;
        }

        .file-info.show {
            display: flex;
        }

        .progress-container {
            margin-top: 25px;
            display: none;
            animation: fadeInScale 0.5s ease-out;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.1) 50%,
                    transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            background-size: 200% 100%;
            border-radius: 10px;
            transition: width 0.3s ease-out;
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: gradientFlow 3s ease infinite;
            position: relative;
            overflow: hidden;
        }

        @keyframes gradientFlow {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* --- New File Upload Design (Uiverse) --- */
        .file-upload-form {
            width: 100%;
            height: fit-content;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }

        .file-upload-label input {
            display: none;
        }

        .file-upload-label svg {
            height: 50px;
            fill: var(--text-secondary);
            /* Adapted to theme */
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .file-upload-label {
            cursor: pointer;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.95) 100%);
            /* Richer gradient background */
            padding: 40px 30px;
            border-radius: 40px;
            border: 2px dashed var(--primary);
            /* Blue dashed border ALWAYS */
            box-shadow: 0px 0px 200px -50px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            width: 100%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .file-upload-label::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .file-upload-label:hover::before {
            opacity: 1;
        }

        .file-upload-label:hover {
            border-color: var(--accent);
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 15px 40px -10px rgba(139, 92, 246, 0.4),
                0 0 0 1px rgba(139, 92, 246, 0.1);
            background-color: rgba(30, 41, 59, 0.85);
        }

        .file-upload-design {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .browse-button {
            background-color: var(--primary);
            padding: 8px 24px;
            border-radius: 20px;
            color: white;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        .browse-button:hover {
            background-color: var(--primary-dark);
            transform: scale(1.05);
        }

        .file-upload-label:hover svg {
            fill: var(--accent);
            transform: scale(1.1);
        }

        /* --- Engine Loader --- */
        .engine-loader {
            position: fixed;
            inset: 0;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .engine-loader.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.05);
            border-top: 4px solid var(--primary);
            border-right: 4px solid var(--secondary);
            border-radius: 50%;
            animation: spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            box-shadow: 0 0 20px rgba(153, 41, 234, 0.4);
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        /* --- Modal --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
            opacity: 0;
            transition: opacity 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: linear-gradient(145deg, #151515, #0a0a0a);
            border-radius: var(--border-radius-xl);
            width: 92%;
            max-width: 480px;
            padding: 35px 30px;
            position: relative;
            transform: translateY(30px) scale(0.92);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(153, 41, 234, 0.4);
            overflow: hidden;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .info-row {
            background: rgba(40, 40, 40, 0.7);
            backdrop-filter: blur(8px);
            padding: 16px 20px;
            border-radius: 16px;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--accent);
            transition: all 0.3s ease;
        }

        .info-row:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(153, 41, 234, 0.2);
        }

        .license-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(153, 41, 234, 0.15);
            padding: 14px 20px;
            border-radius: 16px;
            margin-top: 12px;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
            font-weight: 700;
            border: 1px solid rgba(153, 41, 234, 0.3);
        }

        #closeModal {
            position: absolute;
            left: 20px;
            top: 20px;
            cursor: pointer;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(40, 40, 40, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            border: 1px solid rgba(153, 41, 234, 0.4);
            backdrop-filter: blur(5px);
            z-index: 1;
        }

        #closeModal:hover {
            background: var(--primary);
            color: white;
            transform: rotate(90deg) scale(1.1);
            border-color: transparent;
        }

        .modal-content h3 {
            text-align: center;
            margin-bottom: 25px;
            color: var(--accent);
            font-size: 1.6rem;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(153, 41, 234, 0.3);
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(153, 41, 234, 0.3);
        }

        .info-row span:first-child {
            font-weight: 700;
            color: var(--text-secondary);
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-row span:last-child {
            font-weight: 800;
            color: #ffffff;
            font-size: 1.1rem;
            text-align: left;
            direction: ltr;
            font-family: 'Courier New', monospace;
        }

        #fileInput {
            display: none;
        }

        .modal-loading {
            text-align: center;
            padding: 40px 20px;
        }

        .modal-loading .spinner {
            width: 45px;
            height: 45px;
            margin-bottom: 20px;
            border-width: 4px;
        }

        /* --- Instructions Accordion --- */
        .instructions-toggle {
            background: rgba(40, 40, 40, 0.7);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 18px 20px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(153, 41, 234, 0.3);
            transition: var(--transition-all);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .instructions-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .instructions-toggle:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: rgba(153, 41, 234, 0.5);
        }

        .instructions-toggle.active::before {
            opacity: 1;
        }

        .instructions-toggle.active {
            border-bottom-right-radius: 10px;
            border-bottom-left-radius: 10px;
            border-bottom: none;
        }

        .toggle-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .toggle-icon {
            transition: transform 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
            color: var(--primary);
        }

        .instructions-toggle.active .toggle-icon {
            transform: rotate(180deg);
        }

        .instructions-accordion {
            background: rgba(30, 30, 30, 0.7);
            backdrop-filter: blur(12px);
            border-radius: 0 0 20px 20px;
            margin-top: -2px;
            border: 1px solid rgba(153, 41, 234, 0.3);
            border-top: none;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        .instructions-accordion.active {
            max-height: 500px;
            opacity: 1;
            transform: translateY(0);
        }

        .instruction-item {
            padding: 20px;
            border-bottom: 1px solid rgba(153, 41, 234, 0.2);
            display: flex;
            gap: 15px;
            align-items: flex-start;
            transition: all 0.3s ease;
        }

        .instruction-item:last-child {
            border-bottom: none;
        }

        .instruction-item:hover {
            background: rgba(153, 41, 234, 0.05);
            transform: translateX(5px);
        }

        .instruction-icon {
            width: 32px;
            height: 32px;
            background: rgba(139, 92, 246, 0.15);
            /* Soft Violet Bg */
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1rem;
            flex-shrink: 0;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .instruction-content {
            color: var(--text-secondary);
            line-height: 1.7;
            font-size: 0.95rem;
            flex: 1;
        }

        /* --- Action Button Container --- */
        .action-button-container {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            padding: 0 15px;
        }

        .centered-action-btn {
            width: 220px;
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 28px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(153, 41, 234, 0.5);
            transition: var(--transition-all);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .centered-action-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: rotate(30deg);
            transition: var(--transition-all);
        }

        .centered-action-btn:hover::after {
            animation: shine 1.5s infinite;
        }

        .centered-action-btn:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 12px 30px rgba(153, 41, 234, 0.6);
        }

        .centered-action-btn:disabled {
            opacity: 0.75;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 4px 15px rgba(153, 41, 234, 0.3) !important;
        }

        /* --- Mobile Bottom Navigation --- */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            padding: 15px;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(153, 41, 234, 0.3);
            z-index: 1000;
        }

        .nav-container {
            display: flex;
            width: 100%;
            max-width: 520px;
            padding: 10px;
            border-radius: 20px;
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid rgba(153, 41, 234, 0.3);
        }

        .nav-container a {
            color: #9ca3af;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 12px 5px;
            background-color: transparent;
            border-radius: 18px;
            font-size: 12px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
        }

        .nav-container a.active {
            color: var(--accent);
            background-color: rgba(139, 92, 246, 0.15);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
        }

        .nav-container a.active::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 40%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 0 0 10px 10px;
        }

        .nav-container a:hover:not(.active) {
            color: var(--text-primary);
            background-color: rgba(60, 60, 60, 0.5);
            transform: translateY(-1px);
        }

        .nav-container a svg {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
            fill: currentColor;
        }

        .nav-container a span {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        /* --- Profile Section --- */
        .profile-section {
            text-align: center;
            padding: 30px 20px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 25px rgba(153, 41, 234, 0.5);
        }

        .profile-avatar i {
            font-size: 50px;
            color: white;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .profile-email {
            color: var(--text-secondary);
            margin-bottom: 25px;
            font-size: 0.95rem;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .subscription-card {
            background: rgba(40, 40, 40, 0.7);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            padding: 25px;
            margin-top: 10px;
            border: 1px solid rgba(153, 41, 234, 0.3);
            box-shadow: var(--shadow-sm);
        }

        .subscription-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent);
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .subscription-detail {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(153, 41, 234, 0.2);
        }

        .subscription-detail:last-child {
            border-bottom: none;
        }

        /* --- Instructions inside Subscription Card or below it --- */
        .instructions-block {
            margin-top: 25px;
            text-align: right;
        }

        .instructions-block h3 {
            color: var(--accent);
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 700;
            border-bottom: 1px solid rgba(139, 92, 246, 0.3);
            padding-bottom: 8px;
        }

        .modal-instruction-item {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .modal-instruction-item i {
            color: var(--primary);
            margin-top: 5px;
            min-width: 20px;
        }

        .detail-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .detail-value {
            color: var(--primary);
            font-weight: 700;
        }

        .logout-btn {
            width: 100%;
            background: linear-gradient(45deg, #ef4444, #b91c1c);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 18px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            transition: var(--transition-all);
            margin-top: 20px;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 480px) {
            .glass-card {
                padding: 35px 20px 25px 20px;
            }

            .upload-icon {
                font-size: 50px;
            }

            .header-logo {
                font-size: 1.7rem;
            }

            .nav-container a {
                padding: 10px 3px;
            }

            .nav-container a svg {
                width: 22px;
                height: 22px;
            }

            .modal-content {
                padding: 25px 20px;
            }

            .info-row {
                padding: 14px 15px;
                font-size: 0.95rem;
            }

            .instruction-item {
                padding: 16px;
            }

            .instruction-icon {
                width: 20px;
                height: 20px;
                font-size: 0.7rem;
            }
        }
    </style>
</head>

<body>

    <div class="engine-loader" id="engineLoader">
        <div class="spinner"></div>
        <div id="engineStatus" style="margin-top:20px; font-weight:500; font-size:1.1rem; color:var(--accent);">جاري
            تحميل المحرك ...</div>
    </div>

    <div class="modal-overlay" id="userModal">
        <div class="modal-content">
            <div id="closeModal"><i class="fas fa-times"></i></div>
            <h3>معلومات الاشتراك</h3>

            <div class="modal-loading" id="modalLoading">
                <div class="spinner"></div>
                <div style="color: var(--accent); font-weight:600; font-size:1.1rem;">جاري تحميل البيانات...</div>
            </div>

            <div id="modalContent" style="display: none;">
                <div class="info-row" id="modalNameRow">
                    <span><i class="fas fa-user"></i> الاسم الكامل</span>
                    <span id="modalName" style="color: var(--primary);">...</span>
                </div>
                <div class="info-row" id="modalEmailRow">
                    <span><i class="fas fa-envelope"></i> البريد الإلكتروني</span>
                    <span id="modalEmail" style="color: var(--accent);">...</span>
                </div>
                <div class="info-row" id="modalDaysRow">
                    <span><i class="fas fa-calendar-check"></i> الأيام المتبقية</span>
                    <span id="modalDays" style="color: var(--warning, #fbbf24);">...</span>
                </div>
                <div class="info-row" id="modalExpiryRow">
                    <span><i class="fas fa-hourglass-end"></i> تاريخ الانتهاء</span>
                    <span id="modalExpiry" style="color: var(--text-primary);">...</span>
                </div>
                <div class="info-row" id="modalDeviceRow">
                    <span><i class="fas fa-mobile-alt"></i> نوع الجهاز</span>
                    <span id="modalDeviceType" style="color: var(--secondary);">...</span>
                </div>
                <div class="info-row" id="modalVideosRow">
                    <span><i class="fas fa-video"></i> الفيديوهات المعالجة</span>
                    <span id="modalVideos" style="color: var(--success, #34d399);">...</span>
                </div>
                <div class="info-row">
                    <span><i class="fas fa-file-contract"></i> حالة الاشتراك</span>
                    <span id="modalStatus" style="color: var(--success, #34d399); font-weight: 800;">نشط</span>
                </div>

                <div class="license-wrapper" id="modalLicenseRow">
                    <span style="color: var(--text-secondary);"><i class="fas fa-key"></i> مفتاح الترخيص:</span>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span id="modalLicenseKey" style="color: var(--accent);">••••••••••••</span>
                        <i class="fas fa-eye" id="toggleKeyBtn"
                            style="cursor:pointer; color:var(--accent); font-size:1.1rem;"></i>
                    </div>
                </div>

                <!-- Instructions moved to Modal -->
                <div class="instructions-block">
                    <h3>تعليمات الاستخدام</h3>
                    <div class="modal-instruction-item">
                        <i class="fas fa-share-alt"></i>
                        <span>اضغط على زر المشاركة في المتصفح لإضافة التطبيق إلى الشاشة الرئيسية</span>
                    </div>
                    <div class="modal-instruction-item">
                        <i class="fas fa-video"></i>
                        <span>استخدم فيديوهات عالية الدقة (1080x60) لأفضل نتيجة</span>
                    </div>
                    <div class="modal-instruction-item">
                        <i class="fas fa-upload"></i>
                        <span>ارفع الفيديو بوضع "خاص" ثم حوله إلى عام</span>
                    </div>
                    <div class="modal-instruction-item">
                        <i class="fas fa-cloud"></i>
                        <span>المعالجة تتم عبر سيرفرات سحابية سريعة</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="app-header">
        <div class="header-button" id="homeBtn"><i class="fas fa-home" style="font-size:1.3rem;"></i></div>
        <div class="header-logo-container">
            <div class="header-logo">FlowTik</div>
        </div>
        <div class="header-button" id="profileBtn"><i class="fas fa-user-circle" style="font-size:1.4rem;"></i></div>
    </div>

    <!-- Video Processing Section -->
    <div class="content-section active" id="homeSection">
        <!-- From Uiverse.io by Fundiman (Customized) -->
        <!-- From Uiverse.io by Fundiman (Customized) -->
        <form class="file-upload-form" id="uploadArea">
            <label for="fileInput" class="file-upload-label">
                <div class="file-upload-design">
                    <svg viewBox="0 0 640 512" height="1em" id="uploadIcon">
                        <path
                            d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128H144zm79-217c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l39-39V392c0 13.3 10.7 24 24 24s24-10.7 24-24V257.9l39 39c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0l-80 80z">
                        </path>
                    </svg>
                    <p id="uploadText">إضغط أو اسحب الفيديو</p>
                    <span class="browse-button">اختر ملف</span>
                    <!-- File selected indicator (hidden by default) -->
                    <div id="fileSelectedInfo" style="display:none; margin-top: 15px; text-align: center;">
                        <i class="fas fa-check-circle" style="color: #10B981; font-size: 2rem; margin-bottom: 8px;"></i>
                        <p id="fileName"
                            style="font-size:1rem; font-weight:600; color:var(--text-primary); margin: 5px 0;">video.mp4
                        </p>
                        <p id="fileSize" style="font-size:0.85rem; color:var(--text-secondary);">0 MB</p>
                    </div>
                </div>
                <input id="fileInput" type="file" accept="video/*" />
            </label>
        </form>

        <!-- Moved Action Button HERE to be centrally located below the box -->
        <div class="action-button-container">
            <button class="button magic-btn" id="actionBtn">
                <div class="dots_border"></div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="sparkle">
                    <path class="path" stroke-linejoin="round" stroke-linecap="round" stroke="black" fill="black"
                        d="M14.187 8.096L15 5.25L15.813 8.096C16.0231 8.83114 16.4171 9.50062 16.9577 10.0413C17.4984 10.5819 18.1679 10.9759 18.903 11.186L21.75 12L18.904 12.813C18.1689 13.0231 17.4994 13.4171 16.9587 13.9577C16.4181 14.4984 16.0241 15.1679 15.814 15.903L15 18.75L14.187 15.904C13.9769 15.1689 13.5829 14.4994 13.0423 13.9587C12.5016 13.4181 11.8321 13.0241 11.097 12.814L8.25 12L11.096 11.187C11.8311 10.9769 12.5006 10.5829 13.0413 10.0423C13.5819 9.50162 13.9759 8.83214 14.186 8.097L14.187 8.096Z">
                    </path>
                    <path class="path" stroke-linejoin="round" stroke-linecap="round" stroke="black" fill="black"
                        d="M6 14.25L5.741 15.285C5.59267 15.8785 5.28579 16.4206 4.85319 16.8532C4.42059 17.2858 3.87853 17.5927 3.285 17.741L2.25 18L3.285 18.259C3.87853 18.4073 4.42059 18.7142 4.85319 19.1468C5.28579 19.5794 5.59267 20.1215 5.741 20.715L6 21.75L6.259 20.715C6.40725 20.1216 6.71398 19.5796 7.14639 19.147C7.5788 18.7144 8.12065 18.4075 8.714 18.259L9.75 18L8.714 17.741C8.12065 17.5925 7.5788 17.2856 7.14639 16.853C6.71398 16.4204 6.40725 15.8784 6.259 15.285L6 14.25Z">
                    </path>
                    <path class="path" stroke-linejoin="round" stroke-linecap="round" stroke="black" fill="black"
                        d="M6.5 4L6.303 4.5915C6.24777 4.75718 6.15472 4.90774 6.03123 5.03123C5.90774 5.15472 5.75718 5.24777 5.5915 5.303L5 5.5L5.5915 5.697C5.75718 5.75223 5.90774 5.84528 6.03123 5.96877C6.15472 6.09226 6.24777 6.24282 6.303 6.4085L6.5 7L6.697 6.4085C6.75223 6.24282 6.84528 6.09226 6.96877 5.96877C7.09226 5.84528 7.24282 5.75223 7.4085 5.697L8 5.5L7.4085 5.303C7.24282 5.24777 7.09226 5.15472 6.96877 5.03123C6.84528 4.90774 6.75223 4.75718 6.697 4.5915L6.5 4Z">
                    </path>
                </svg>
                <span class="text_button">بدء المعالجة</span>
            </button>
        </div>



        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div
                style="display:flex; justify-content:space-between; font-size:0.85rem; margin-top:8px; font-weight:600;">
                <span id="progressPercent" style="color:var(--accent);">0%</span>
                <span id="progressLabel" style="color:var(--text-secondary);">تمت عمليةالمعالجة...</span>
            </div>
        </div>
    </div>






    </div>

    <!-- Profile Section -->
    <div class="content-section" id="profileSection">
        <div class="profile-section">
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            <h2 class="profile-name" id="profileName">Loading...</h2>
            <p class="profile-email" id="profileEmail">Loading...</p>

            <div class="profile-stats">
                <div class="stat-item">
                    <div class="stat-value" id="processedFiles">0</div>
                    <div class="stat-label">ملفات</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="processedVideos">0</div>
                    <div class="stat-label">فيديوهات</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="remainingDays">0</div>
                    <div class="stat-label">أيام</div>
                </div>
            </div>

            <div class="subscription-card">
                <div class="subscription-title">
                    <i class="fas fa-crown"></i>
                    <span>الاشتراك المميز</span>
                </div>

                <div class="subscription-detail">
                    <span class="detail-label">مفتاح الاشتراك</span>
                    <span class="detail-value" id="subscriptionKey">Loading...</span>
                </div>

                <div class="subscription-detail">
                    <span class="detail-label">الأيام المتبقية</span>
                    <span class="detail-value" id="subscriptionDays">Loading...</span>
                </div>

                <div class="subscription-detail">
                    <span class="detail-label">تاريخ الانتهاء</span>
                    <span class="detail-value" id="subscriptionExpiry">Loading...</span>
                </div>

                <div class="subscription-detail">
                    <span class="detail-label">الجهاز</span>
                    <span class="detail-value" id="subscriptionDevice">Loading...</span>
                </div>

                <div class="subscription-detail">
                    <span class="detail-label">الفيديوهات المعالجة</span>
                    <span class="detail-value" id="processedVideosCount">Loading...</span>
                </div>
            </div>

            <button class="logout-btn" id="mobileLogoutBtn">
                <i class="fas fa-sign-out-alt" style="margin-left:8px;"></i> تسجيل الخروج
            </button>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <div class="nav-container">
            <a href="#" id="navHome" class="active">
                <svg viewBox="0 0 20 20" fill="currentColor">
                    <path
                        d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z">
                    </path>
                </svg>
                <span>الرئيسية</span>
            </a>
            <a href="#" id="navProfile">
                <svg viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                        clip-rule="evenodd"></path>
                </svg>
                <span>الملف</span>
            </a>
        </div>
    </div>

    <script>
        const ui = {
            body: document.body,
            uploadArea: document.getElementById('uploadArea'),
            actionBtn: document.getElementById('actionBtn'),
            fileInput: document.getElementById('fileInput'),
            uploadIcon: document.getElementById('uploadIcon'),
            uploadText: document.getElementById('uploadText'),
            fileSelectedInfo: document.getElementById('fileSelectedInfo'),
            fileName: document.getElementById('fileName'),
            fileSize: document.getElementById('fileSize'),
            progressContainer: document.getElementById('progressContainer'),
            progressFill: document.getElementById('progressFill'),
            progressPercent: document.getElementById('progressPercent'),
            engineLoader: document.getElementById('engineLoader'),
            homeBtn: document.getElementById('homeBtn'),
            profileBtn: document.getElementById('profileBtn'),
            userModal: document.getElementById('userModal'),
            closeModal: document.getElementById('closeModal'),
            modalLoading: document.getElementById('modalLoading'),
            modalContent: document.getElementById('modalContent'),
            modalName: document.getElementById('modalName'),
            modalNameRow: document.getElementById('modalNameRow'),
            modalEmail: document.getElementById('modalEmail'),
            modalEmailRow: document.getElementById('modalEmailRow'),
            modalDays: document.getElementById('modalDays'),
            modalDaysRow: document.getElementById('modalDaysRow'),
            modalExpiry: document.getElementById('modalExpiry'),
            modalExpiryRow: document.getElementById('modalExpiryRow'),
            modalDeviceType: document.getElementById('modalDeviceType'),
            modalDeviceRow: document.getElementById('modalDeviceRow'),
            modalLicenseKey: document.getElementById('modalLicenseKey'),
            modalLicenseRow: document.getElementById('modalLicenseRow'),
            modalVideos: document.getElementById('modalVideos'),
            modalVideosRow: document.getElementById('modalVideosRow'),
            modalStatus: document.getElementById('modalStatus'),
            toggleKeyBtn: document.getElementById('toggleKeyBtn'),
            homeSection: document.getElementById('homeSection'),
            profileSection: document.getElementById('profileSection'),
            navHome: document.getElementById('navHome'),
            navProfile: document.getElementById('navProfile'),
            mobileLogoutBtn: document.getElementById('mobileLogoutBtn'),
            profileName: document.getElementById('profileName'),
            profileEmail: document.getElementById('profileEmail'),
            processedFiles: document.getElementById('processedFiles'),
            processedVideos: document.getElementById('processedVideos'),
            remainingDays: document.getElementById('remainingDays'),
            subscriptionStatus: document.getElementById('subscriptionStatus'),
            subscriptionDays: document.getElementById('subscriptionDays'),
            subscriptionExpiry: document.getElementById('subscriptionExpiry'),
            subscriptionDevice: document.getElementById('subscriptionDevice'),
            subscriptionKey: document.getElementById('subscriptionKey'), // New element
            processedVideosCount: document.getElementById('processedVideosCount'), // New element

        };

        let currentFile = null;
        let ffmpeg = null;
        let isEngineReady = false;
        let fullLicenseKey = "";
        let isKeyVisible = false;


        // Load profile data for the profile section - using JSONBin data
        async function loadProfileData() {
            try {
                const currentLicenseKey = localStorage.getItem(CONFIG.STORAGE.LICENSE_KEY);
                const currentDeviceId = localStorage.getItem(CONFIG.STORAGE.DEVICE_ID);

                if (!currentLicenseKey || !currentDeviceId) {
                    console.error("Missing license or device info");
                    return;
                }

                const response = await fetch('/api/check-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        licenseKey: currentLicenseKey,
                        deviceId: currentDeviceId
                    })
                });

                const data = await response.json();

                if (data.valid) {
                    const licenseData = data.license;
                    const expiry = new Date(licenseData.expiresAt);
                    const now = new Date();
                    const diffTime = expiry - now;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    // Update profile section with real data
                    // Use device name from license data or default to "User"
                    const deviceName = licenseData.device_name || licenseData.deviceName || "User";

                    // Check if UI elements exist before updating them
                    if (ui.profileName) ui.profileName.textContent = deviceName;
                    if (ui.profileEmail) ui.profileEmail.textContent = currentLicenseKey || "License Key";

                    let processedVideos = 0;
                    if (licenseData.processed_videos !== undefined) {
                        processedVideos = licenseData.processed_videos;
                    } else if (licenseData.processedVideos !== undefined) {
                        processedVideos = licenseData.processedVideos;
                    }

                    if (ui.processedFiles) ui.processedFiles.textContent = processedVideos;
                    if (ui.processedVideos) ui.processedVideos.textContent = processedVideos;
                    if (ui.processedVideosCount) ui.processedVideosCount.textContent = processedVideos; // New field
                    if (ui.remainingDays) ui.remainingDays.textContent = diffDays > 0 ? diffDays : 0;

                    let statusText = "نشط";
                    if (diffDays <= 0) {
                        statusText = "منتهي";
                    } else if (diffDays <= 3) {
                        statusText = "ينتهي قريباً";
                    }
                    if (ui.subscriptionStatus) ui.subscriptionStatus.textContent = statusText;
                    if (ui.subscriptionDays) ui.subscriptionDays.textContent = diffDays > 0 ? diffDays + " يوم" : "منتهي";
                    if (ui.subscriptionKey) ui.subscriptionKey.textContent = currentLicenseKey || "غير متوفر"; // New field

                    if (ui.subscriptionExpiry) ui.subscriptionExpiry.textContent = expiry.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });

                    let deviceDisplay = "جهاز غير معروف";
                    if (licenseData.device_name !== undefined) {
                        deviceDisplay = licenseData.device_name;
                    } else if (licenseData.deviceName !== undefined) {
                        deviceDisplay = licenseData.deviceName;
                    }
                    if (ui.subscriptionDevice) ui.subscriptionDevice.textContent = deviceDisplay;
                } else {
                    console.error("Invalid session response:", data);
                }
            } catch (e) {
                console.error("Error loading profile section:", e);
            }
        }

        // 1. Original auth check logic
        document.addEventListener('DOMContentLoaded', async () => {
            await auth.init();
            if (!auth.isAuthenticated) {
                window.location.href = 'login.html';
                return;
            }
            ui.body.classList.add('loaded');

            // Load profile data immediately
            await loadProfileData();

            initEngine();
        });

        // 2. Engine initialization
        async function initEngine() {
            try {
                // Show loader initially
                ui.engineLoader.classList.add('active');

                // Initialize using our new Manager (Smart Caching)
                // This will check IndexedDB first, then Server
                ffmpeg = await ffmpegManager.initialize();

                if (ffmpegManager.isFFmpegReady()) {
                    isEngineReady = true;
                    ui.engineLoader.classList.remove('active');
                    // Notification handled by manager
                }

            } catch (e) {
                console.error("Engine Load Error:", e);
                ui.engineLoader.classList.remove('active');

                if (e.message === 'SECURITY_HEADERS_MISSING') {
                    showNotification("إعدادات الأمان غير متوافقة (COOP/COEP)", "error", 8000);
                } else if (e.message.includes('LIBRARY_NOT_LOADED')) {
                    showNotification("فشل تحميل مكتبة المعالجة", "error", 6000);
                } else {
                    showNotification("حدث خطأ في تحميل المحرك", "error", 5000);
                }
            }
        }

        // 3. File selection logic
        // 3. File selection logic
        // Button only for PROCESSING now. Input triggered via label/drag-drop.
        // 3. File selection logic
        // Button only for PROCESSING now. Input triggered via label/drag-drop.
        // Initially disable the button
        ui.actionBtn.disabled = true;

        ui.actionBtn.onclick = () => {
            if (currentFile) startProcessing();
        };

        ui.fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 1024 * 1024 * 1024) {
                    showNotification("الحد الأقصى 1 جيجابايت", "error", 4000);
                    ui.fileInput.value = '';
                    return;
                }
                currentFile = file;
                ui.fileName.textContent = file.name;
                ui.fileSize.textContent = (file.size / (1024 * 1024)).toFixed(1) + ' MB';

                // Hide upload prompt, show file selected info INSIDE the box
                ui.uploadIcon.style.display = 'none';
                ui.uploadText.style.display = 'none';
                document.querySelector('.browse-button').style.display = 'none';
                ui.fileSelectedInfo.style.display = 'block';

                ui.actionBtn.disabled = false; // Enable button
                ui.actionBtn.style.opacity = '1';
                ui.actionBtn.style.cursor = 'pointer';
            }
        };

        // 4. Mobile Logout Button
        ui.mobileLogoutBtn.onclick = () => {
            if (confirm('هل تود تسجيل الخروج؟')) {
                auth.logout();
                window.location.href = 'login.html';
            }
        };

        // 5. Navigation between sections
        ui.navHome.addEventListener('click', (e) => {
            e.preventDefault();
            ui.homeSection.classList.add('active');
            ui.profileSection.classList.remove('active');
            ui.navHome.classList.add('active');
            ui.navProfile.classList.remove('active');
        });

        ui.navProfile.addEventListener('click', (e) => {
            e.preventDefault();
            ui.profileSection.classList.add('active');
            ui.homeSection.classList.remove('active');
            ui.navProfile.classList.add('active');
            ui.navHome.classList.remove('active');

            // Reload profile data when switching to profile
            loadProfileData();
        });

        ui.homeBtn.addEventListener('click', () => {
            ui.homeSection.classList.add('active');
            ui.profileSection.classList.remove('active');
            ui.navHome.classList.add('active');
            ui.navProfile.classList.remove('active');
        });

        ui.profileBtn.addEventListener('click', () => {
            ui.profileSection.classList.add('active');
            ui.homeSection.classList.remove('active');
            ui.navProfile.classList.add('active');
            ui.navHome.classList.remove('active');

            // Reload profile data when clicking profile button
            loadProfileData();
        });

        // 6. Profile data loading - REAL DATA FROM JSONBIN
        ui.profileBtn.onclick = async () => {
            ui.userModal.classList.add('active');
            ui.modalLoading.style.display = 'block';
            ui.modalContent.style.display = 'none';

            // Reset elements
            [ui.modalNameRow, ui.modalEmailRow, ui.modalDaysRow, ui.modalExpiryRow, ui.modalDeviceRow, ui.modalLicenseRow, ui.modalVideosRow].forEach(el => {
                if (el) el.style.display = 'none';
            });

            try {
                // Fetch data directly from JSONBin - Direct method
                const currentLicenseKey = localStorage.getItem(CONFIG.STORAGE.LICENSE_KEY);
                const currentDeviceId = localStorage.getItem(CONFIG.STORAGE.DEVICE_ID);

                if (!currentLicenseKey || !currentDeviceId) {
                    throw new Error("Missing license or device info");
                }

                // Use direct API check-session call to fetch data from JSONBin
                const response = await fetch('/api/check-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        licenseKey: currentLicenseKey,
                        deviceId: currentDeviceId
                    })
                });

                const data = await response.json();

                if (data.valid) {
                    setTimeout(() => {
                        ui.modalLoading.style.display = 'none';
                        ui.modalContent.style.display = 'block';

                        // Update data from JSONBin directly
                        const licenseData = data.license;

                        // Calculate remaining days from JSONBin
                        const expiry = new Date(licenseData.expiresAt);
                        const now = new Date();
                        const diffTime = expiry - now;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                        // Determine days message
                        let daysText = "";
                        if (diffDays > 1) {
                            daysText = diffDays + " days";
                        } else if (diffDays === 1) {
                            daysText = "1 day";
                        } else if (diffDays === 0) {
                            // If expiry is today, show time left
                            const hoursLeft = Math.floor(diffTime / (1000 * 60 * 60));
                            if (hoursLeft > 0) {
                                daysText = "expires today - " + hoursLeft + " hours left";
                            } else {
                                daysText = "expires today";
                            }
                        } else {
                            daysText = "expired";
                        }
                        ui.modalDays.textContent = daysText;

                        // Expiry date from JSONBin with time
                        ui.modalExpiry.textContent = expiry.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: true
                        });

                        // Processed videos from JSONBin - support both field names
                        let processedVideos = 0;
                        if (licenseData.processed_videos !== undefined) {
                            processedVideos = licenseData.processed_videos;
                        } else if (licenseData.processedVideos !== undefined) {
                            processedVideos = licenseData.processedVideos;
                        } else {
                            processedVideos = 0;
                        }
                        ui.modalVideos.textContent = processedVideos;

                        // Device name from JSONBin - support both field names
                        let deviceName = "جهاز غير معروف";
                        if (licenseData.device_name !== undefined) {
                            deviceName = licenseData.device_name;
                        } else if (licenseData.deviceName !== undefined) {
                            deviceName = licenseData.deviceName;
                        }
                        ui.modalDeviceType.textContent = deviceName;

                        // License key from JSONBin
                        fullLicenseKey = licenseData.key || currentLicenseKey || "N/A";
                        ui.modalLicenseKey.textContent = isKeyVisible ? fullLicenseKey : "••••••••••••";

                        // Show elements with animation
                        setTimeout(() => ui.modalNameRow.style.display = 'flex', 50);
                        setTimeout(() => ui.modalEmailRow.style.display = 'flex', 100);
                        setTimeout(() => ui.modalDaysRow.style.display = 'flex', 150);
                        setTimeout(() => ui.modalExpiryRow.style.display = 'flex', 200);
                        setTimeout(() => ui.modalVideosRow.style.display = 'flex', 250);
                        setTimeout(() => ui.modalDeviceRow.style.display = 'flex', 300);
                        setTimeout(() => ui.modalLicenseRow.style.display = 'flex', 350);

                    }, 800); // Simulate loading time
                } else {
                    // If session is invalid, show error message
                    ui.modalLoading.innerHTML = '<div style="color:#ef4444;"><i class="fas fa-exclamation-triangle"></i><br>الجلسة غير صالحة، يرجى تسجيل الدخول مجددًا</div>';
                    setTimeout(() => {
                        auth.logout();
                        window.location.href = 'login.html';
                    }, 2000);
                }
            } catch (e) {
                console.error("Error loading profile:", e);
                ui.modalLoading.innerHTML = '<div style="color:#ef4444;"><i class="fas fa-exclamation-triangle"></i><br>خطأ في تحميل البيانات</div>';
            }
        };

        ui.toggleKeyBtn.onclick = () => {
            isKeyVisible = !isKeyVisible;
            ui.modalLicenseKey.textContent = isKeyVisible ? fullLicenseKey : "••••••••••••";
            ui.toggleKeyBtn.classList.toggle('fa-eye');
            ui.toggleKeyBtn.classList.toggle('fa-eye-slash');
        };

        ui.closeModal.onclick = () => {
            ui.userModal.classList.remove('active');
            setTimeout(() => {
                ui.modalLoading.style.display = 'block';
                ui.modalContent.style.display = 'none';
                ui.modalLicenseKey.textContent = "••••••••••••";
                ui.toggleKeyBtn.classList.remove('fa-eye-slash');
                ui.toggleKeyBtn.classList.add('fa-eye');
                isKeyVisible = false;
            }, 300);
        };

        ui.userModal.addEventListener('click', (e) => {
            if (e.target === ui.userModal) {
                ui.closeModal.click();
            }
        });

        // Mobile Navigation
        ui.navHome.onclick = (e) => {
            e.preventDefault();
            ui.homeSection.classList.add('active');
            ui.profileSection.classList.remove('active');
            ui.navHome.classList.add('active');
            ui.navProfile.classList.remove('active');
        };

        ui.navProfile.onclick = (e) => {
            e.preventDefault();
            ui.profileSection.classList.add('active');
            ui.homeSection.classList.remove('active');
            ui.navProfile.classList.add('active');
            ui.navHome.classList.remove('active');

            // Load profile data when switching to profile section
            loadProfileData();
        };

        // 6. Video processing logic - Simplified 5-second progress
        async function startProcessing() {
            if (!isEngineReady) {
                ui.engineLoader.classList.add('active');
                showNotification("يرجى الانتظار، جاري تحميل المحرك...", "info", 3000);
                return;
            }

            ui.actionBtn.disabled = true;
            const originalBtnContent = ui.actionBtn.innerHTML; // Save original state

            // Change button to solid black with processing text
            ui.actionBtn.style.background = '#000';
            ui.actionBtn.style.color = '#fff';
            ui.actionBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري المعالجة...';

            // ✅ NEW: Strict Server-Side Verification
            // Checks if license is active AND exists in DB
            const verification = await auth.verifyBeforeProcessing();

            if (!verification.valid) {
                ui.actionBtn.disabled = false;
                ui.actionBtn.style.background = ''; // Reset
                ui.actionBtn.style.color = '';
                ui.actionBtn.innerHTML = originalBtnContent; // Restore button (need to save it?) check context
                // Actually easier to just reload or show error

                showNotification(verification.message || "فشل التحقق من الاشتراك", "error", 4000);

                if (verification.reason === 'EXPIRED' || verification.reason === 'INVALID_SESSION') {
                    setTimeout(() => {
                        auth.logout();
                        window.location.href = 'login.html';
                    }, 2000);
                }
                return;
            }

            ui.actionBtn.style.display = 'none';
            ui.progressContainer.style.display = 'block';

            try {
                // Simulate 5-second processing with smooth progress
                let progress = 0;
                const duration = 5000; // 5 seconds
                const interval = 50; // Update every 50ms
                const increment = (100 / duration) * interval;

                const progressInterval = setInterval(() => {
                    progress += increment;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(progressInterval);

                        // Process and download video
                        processAndDownload();
                    }
                    ui.progressFill.style.width = progress + '%';
                    ui.progressPercent.textContent = Math.round(progress) + '%';
                }, interval);

            } catch (e) {
                console.error(e);
                showNotification("حدث خطأ غير متوقع أثناء المعالجة", "error", 5000);
                setTimeout(() => {
                    location.reload();
                }, 3000);
            }
        }

        async function processAndDownload() {
            try {
                ffmpeg.FS('writeFile', 'input.mp4', new Uint8Array(await currentFile.arrayBuffer()));
                await ffmpeg.run('-itsscale', '2', '-i', 'input.mp4', '-c', 'copy', 'output.mp4');

                const data = ffmpeg.FS('readFile', 'output.mp4');
                const url = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
                const a = document.createElement('a');
                a.href = url; a.download = 'flowtik_video.mp4'; a.click();

                // Success Notification
                showNotification("تمت معالجة الفيديو بنجاح! جاري التنزيل...", "success", 5000);

                setTimeout(() => {
                    location.reload();
                }, 4000);
            } catch (e) {
                console.error(e);
                showNotification("حدث خطأ أثناء المعالجة", "error", 5000);
                setTimeout(() => {
                    location.reload();
                }, 3000);
            }
        }

        ui.profileBtn.addEventListener('click', function () {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 200);
        });

        ui.homeBtn.addEventListener('click', function () {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 200);
        });



        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && ui.userModal.classList.contains('active')) {
                ui.closeModal.click();
            }
        });
    </script>
</body>

</html>